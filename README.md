# MangaMind - æ¼«ç”»æ–‡æœ¬è¯†åˆ«é¡¹ç›®

## é¡¹ç›®æ¨¡å—

### OCR Dialog æ¨¡å—
OCR å¯¹è¯æ¡†è¯†åˆ«å¤„ç†å™¨ï¼ŒåŸºäº PaddleOCR å®ç°ã€‚ä¸“é—¨è´Ÿè´£æ–‡æœ¬æ£€æµ‹ã€OCRè¯†åˆ«ã€å¯¹è¯æ¡†æ™ºèƒ½åˆå¹¶ç­‰åŠŸèƒ½ã€‚

### Agents æ¨¡å—  
æ™ºèƒ½ä½“å·¥ä½œæµæ¨¡å—ï¼ŒåŸºäº LangGraph å®ç°ã€‚è´Ÿè´£è°ƒç”¨ OCR æ¨¡å—å¤„ç†å›¾åƒï¼Œç„¶åä½¿ç”¨ LLM ç”Ÿæˆå¯¹è¯è„šæœ¬å’Œæ•…äº‹æ€»ç»“ã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸ” **é«˜ç²¾åº¦æ–‡æœ¬æ£€æµ‹**: åŸºäº PP-OCRv5 é«˜ç²¾åº¦æ¨¡å‹
- ğŸ¯ **æ™ºèƒ½å¯¹è¯æ¡†åˆå¹¶**: è‡ªåŠ¨è¯†åˆ«å’Œåˆå¹¶ç›¸é‚»çš„å¯¹è¯æ¡†åŒºåŸŸ
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­æ–‡ï¼ˆç®€ä½“/ç¹ä½“ï¼‰ã€æ—¥æ–‡ã€è‹±æ–‡ç­‰å¤šç§è¯­è¨€
- ğŸ“Š **å¯¹è¯åºåˆ—ç”Ÿæˆ**: æŒ‰ç…§é˜…è¯»é¡ºåºç”Ÿæˆå¯¹è¯åºåˆ—ï¼ˆä»å³ä¸Šåˆ°å·¦ä¸‹ï¼‰
- ğŸš€ **æ‰¹é‡å¤„ç†**: æ”¯æŒæ–‡ä»¶å¤¹æ‰¹é‡å¤„ç†å’Œç»“æœç»Ÿè®¡
- ğŸ“ **å®Œæ•´æ—¥å¿—ç³»ç»Ÿ**: æ›¿ä»£æ‰€æœ‰printè¯­å¥ï¼Œæ”¯æŒæ–‡ä»¶å’Œæ§åˆ¶å°è¾“å‡º
- âš™ï¸ **æ¨¡å—åŒ–æ¶æ„**: å·¥ä¸šçº§é¡¹ç›®ç»“æ„ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- ğŸ¤– **æ™ºèƒ½å·¥ä½œæµ**: åŸºäºLangGraphçš„ç«¯åˆ°ç«¯æ•…äº‹ç”Ÿæˆæµæ°´çº¿
- ğŸ§  **LLMé›†æˆ**: æ”¯æŒOpenAIç­‰LLMæ¨¡å‹è¿›è¡Œå¯¹è¯åˆ†æå’Œæ•…äº‹åˆ›ä½œ

## é¡¹ç›®ç»“æ„

```
MangaMind/
â”œâ”€â”€ ocr_dialog/                   # OCRå¯¹è¯æ¡†å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ocr_engine.py         # OCRè¯†åˆ«å¼•æ“
â”‚   â”‚   â”œâ”€â”€ text_detector.py      # æ–‡æœ¬æ£€æµ‹å™¨
â”‚   â”‚   â”œâ”€â”€ dialog_merger.py      # å¯¹è¯æ¡†åˆå¹¶å™¨
â”‚   â”‚   â””â”€â”€ processor.py          # ä¸»å¤„ç†å™¨
â”‚   â””â”€â”€ utils/                    # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ logger.py             # æ—¥å¿—ç³»ç»Ÿ
â”‚       â”œâ”€â”€ image_processor.py    # å›¾åƒå¤„ç†å·¥å…·
â”‚       â””â”€â”€ visualizer.py         # å¯è§†åŒ–å·¥å…·
â”œâ”€â”€ agents/                       # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”œâ”€â”€ config/                   # æ™ºèƒ½ä½“é…ç½®
â”‚   â”‚   â””â”€â”€ settings.py          # LLMå’Œå·¥ä½œæµé…ç½®
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ agent_processor.py    # æ™ºèƒ½ä½“ä¸»å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ llm_client.py         # LLMå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ workflows/                # LangGraphå·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ story_processor.py    # æ•…äº‹å¤„ç†å·¥ä½œæµ
â”‚   â””â”€â”€ utils/                    # æ™ºèƒ½ä½“å·¥å…·
â”œâ”€â”€ main.py                       # OCRæ¨¡å—å…¥å£è„šæœ¬
â”œâ”€â”€ batch_process.py              # OCRæ‰¹é‡å¤„ç†è„šæœ¬
â”œâ”€â”€ story_agent.py                # æ™ºèƒ½ä½“ä¸»å…¥å£è„šæœ¬
â”œâ”€â”€ requirements.txt             # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

## å®‰è£…å’Œé…ç½®

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PaddleOCR >= 2.7.0 (OCRæ¨¡å—)
- PaddlePaddle >= 2.5.0 (OCRæ¨¡å—)
- OpenAI >= 1.0.0 (æ™ºèƒ½ä½“æ¨¡å— - å…¼å®¹Grok API)
- LangGraph >= 0.0.40 (æ™ºèƒ½ä½“æ¨¡å—)

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/manga-mind/manga-mind.git
cd MangaMind

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### å•ä¸ªå›¾åƒå¤„ç†

```bash
# åŸºæœ¬æ–‡æœ¬æ£€æµ‹
python main.py image.jpg

# å¯ç”¨OCRæ–‡å­—è¯†åˆ«
python main.py image.jpg --ocr

# OCR + å¯¹è¯æ¡†åˆå¹¶
python main.py image.jpg --ocr --merge

# è‡ªå®šä¹‰è¯­è¨€å’Œç½®ä¿¡åº¦
python main.py image.jpg --ocr --merge --lang chinese_cht --confidence 0.8

# å®Œæ•´å‚æ•°ç¤ºä¾‹
python main.py image.jpg --ocr --merge --lang chinese_cht --confidence 0.8 --output results --gpu
```

### æ‰¹é‡å¤„ç†

```bash
# æ‰¹é‡å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾åƒ
python batch_process.py input_folder

# è‡ªå®šä¹‰è¾“å‡ºç›®å½•å’Œå‚æ•°
python batch_process.py input_folder --output batch_results --confidence 0.8 --lang chinese_cht

# é™é»˜æ¨¡å¼ï¼Œè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
python batch_process.py input_folder --quiet --log-file processing.log
```

### æ™ºèƒ½ä½“å·¥ä½œæµ (NEW!)

```bash
# è®¾ç½®Grok APIå¯†é’¥
export XAI_API_KEY="your-xai-api-key"

# ç«¯åˆ°ç«¯æ•…äº‹ç”Ÿæˆï¼šOCR + å¯¹è¯è„šæœ¬ + æ•…äº‹æ€»ç»“
python story_agent.py input_folder

# ä½¿ç”¨Grok-2æ¨¡å‹
python story_agent.py input_folder --model grok-2

# è°ƒæ•´åˆ›é€ æ€§ï¼ˆé™ä½æ¸©åº¦ï¼‰
python story_agent.py input_folder --temperature 0.3

# æ˜¾ç¤ºæ™ºèƒ½ä½“çŠ¶æ€
python story_agent.py input_folder --status
```

### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

#### ä¸»ç¨‹åºå‚æ•° (main.py)

- `image_path`: è¾“å…¥å›¾ç‰‡è·¯å¾„
- `--output, -o`: è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: outputï¼‰
- `--ocr`: å¯ç”¨OCRæ–‡å­—è¯†åˆ«ï¼ˆé»˜è®¤ä»…æ£€æµ‹ï¼‰
- `--lang, -l`: OCRè¯†åˆ«è¯­è¨€ï¼ˆé»˜è®¤: chinese_chtï¼‰
- `--confidence, -c`: ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆé»˜è®¤: 0.75ï¼‰
- `--merge, -m`: åˆå¹¶å¯èƒ½çš„å¯¹è¯æ¡†åŒºåŸŸ
- `--merge-distance`: å¯¹è¯æ¡†åˆå¹¶æœ€å¤§è·ç¦»ï¼ˆé»˜è®¤: 40.0ï¼‰
- `--gpu`: ä½¿ç”¨GPUåŠ é€Ÿ
- `--log-level`: æ—¥å¿—çº§åˆ«ï¼ˆDEBUG/INFO/WARNING/ERRORï¼‰
- `--log-file`: æ—¥å¿—æ–‡ä»¶è·¯å¾„
- `--quiet, -q`: é™é»˜æ¨¡å¼

#### æ‰¹å¤„ç†å‚æ•° (batch_process.py)

- `input_folder`: è¾“å…¥å›¾åƒæ–‡ä»¶å¤¹è·¯å¾„
- å…¶ä»–å‚æ•°ä¸ä¸»ç¨‹åºç›¸åŒ

## è¾“å‡ºç»“æœ

### æ–‡ä»¶è¾“å‡º

1. **åŸºç¡€ç»“æœ**:
   - `detected_<å›¾ç‰‡å>.json` - æ–‡æœ¬æ£€æµ‹ç»“æœ
   - `ocr_<å›¾ç‰‡å>.json` - OCRè¯†åˆ«ç»“æœ
   - `detected_<å›¾ç‰‡å>.jpg` - å¯è§†åŒ–æ£€æµ‹å›¾ç‰‡

2. **åˆå¹¶ç»“æœ**ï¼ˆå¯ç”¨ --mergeï¼‰:
   - `merged_<å›¾ç‰‡å>.json` - å¯¹è¯æ¡†åˆå¹¶ç»“æœ
   - `dialog_sequence_<å›¾ç‰‡å>.json` - æŒ‰é˜…è¯»é¡ºåºçš„å¯¹è¯åºåˆ—

3. **æ‰¹å¤„ç†ç»“æœ**:
   - `batch_dialogs.json` - ç®€åŒ–çš„æ‰¹å¤„ç†ç»Ÿè®¡ç»“æœ

### JSONæ ¼å¼è¯´æ˜

#### æ£€æµ‹ç»“æœæ ¼å¼
```json
{
    "input_path": "image.jpg",
    "confidence_threshold": 0.75,
    "total_detections": 10,
    "high_confidence_detections": 5,
    "dt_polys": [[[x1,y1],[x2,y2],[x3,y3],[x4,y4]]],
    "dt_scores": [0.95, 0.92, 0.98],
    "ocr_enabled": false
}
```

#### å¯¹è¯åºåˆ—æ ¼å¼
```json
{
    "total_dialogs": 3,
    "reading_order": "right_top_to_left_bottom",
    "dialog_sequence": [
        {
            "sequence_id": 1,
            "dialog_text": "ä½ å¥½ä¸–ç•Œ",
            "confidence_score": 0.95,
            "dialog_type": "merged",
            "text_count": 2,
            "position": {"right_top_x": 100, "right_top_y": 50}
        }
    ]
}
```

## é…ç½®è¯´æ˜

### æ”¯æŒçš„è¯­è¨€ä»£ç 
- `chinese_cht` - ç¹ä½“ä¸­æ–‡ï¼ˆé»˜è®¤ï¼‰
- `chinese_sim` - ç®€ä½“ä¸­æ–‡
- `japanese` - æ—¥æ–‡
- `english` - è‹±æ–‡
- `korean` - éŸ©æ–‡

### æ¨¡å‹é…ç½®
- **æ£€æµ‹æ¨¡å‹**: PP-OCRv5_server_detï¼ˆé«˜ç²¾åº¦ï¼‰
- **è¯†åˆ«æ¨¡å‹**: å¤šè¯­è¨€æ–‡æœ¬è¯†åˆ«æ¨¡å‹
- **GPUæ”¯æŒ**: å¯é€‰å¯ç”¨GPUåŠ é€Ÿ

## å¼€å‘å’Œæ‰©å±•

### ä»£ç é£æ ¼
é¡¹ç›®ä½¿ç”¨ Black è¿›è¡Œä»£ç æ ¼å¼åŒ–ï¼Œflake8 è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼š

```bash
# æ ¼å¼åŒ–ä»£ç 
black manga_mind/

# ä»£ç è´¨é‡æ£€æŸ¥
flake8 manga_mind/

# ç±»å‹æ£€æŸ¥
mypy manga_mind/
```

### æ¨¡å—æ‰©å±•
é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯ä»¥è½»æ¾æ‰©å±•æ–°åŠŸèƒ½ï¼š

1. **æ–°å¢æ£€æµ‹ç®—æ³•**: åœ¨ `core/` ç›®å½•ä¸‹æ·»åŠ æ–°çš„æ£€æµ‹å™¨
2. **è‡ªå®šä¹‰åˆå¹¶ç­–ç•¥**: æ‰©å±• `DialogMerger` ç±»
3. **æ–°å¢è¾“å‡ºæ ¼å¼**: åœ¨ `utils/` ç›®å½•ä¸‹æ·»åŠ æ–°çš„ç¼–ç å™¨

## å¸¸è§é—®é¢˜

**Q: é¦–æ¬¡è¿è¡Œå¾ˆæ…¢ï¼Ÿ**
A: PaddleOCRä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œé¦–æ¬¡è¿è¡Œéœ€è¦ä¸‹è½½æ—¶é—´

**Q: å¦‚ä½•æé«˜æ£€æµ‹ç²¾åº¦ï¼Ÿ**
A: å¯ä»¥é™ä½ç½®ä¿¡åº¦é˜ˆå€¼æˆ–ä½¿ç”¨æ›´é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡

**Q: å¯¹è¯æ¡†åˆå¹¶æ•ˆæœä¸ç†æƒ³ï¼Ÿ**
A: å¯ä»¥è°ƒæ•´ `--merge-distance` å‚æ•°æ¥ä¼˜åŒ–åˆå¹¶è·ç¦»

**Q: æ”¯æŒå“ªäº›å›¾åƒæ ¼å¼ï¼Ÿ**
A: æ”¯æŒ JPGã€PNGã€BMPã€TIFFã€WEBP ç­‰å¸¸è§æ ¼å¼

**Q: å¦‚ä½•ä½¿ç”¨GPUåŠ é€Ÿï¼Ÿ**
A: å®‰è£…GPUç‰ˆæœ¬ä¾èµ–å¹¶æ·»åŠ  `--gpu` å‚æ•°

## è®¸å¯è¯

MIT License

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## æ›´æ–°æ—¥å¿—

### v1.0.0
- ğŸ‰ åˆå§‹å‘å¸ƒ
- âœ¨ å·¥ä¸šçº§æ¨¡å—åŒ–æ¶æ„é‡æ„
- ğŸ“ å®Œæ•´æ—¥å¿—ç³»ç»Ÿå®ç°
- ğŸš€ æ‰¹é‡å¤„ç†åŠŸèƒ½ä¼˜åŒ–
- ğŸ“¦ åŒ…ç®¡ç†å’Œå®‰è£…æ”¯æŒ